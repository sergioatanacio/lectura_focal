---
title: "PROMPT COMPLETO — App de Lectura Unidad-por-Unidad (React + TS + Hexagonal + sql.js/IndexedDB)"
lang: es
format:
  html:
    toc: true
    toc-depth: 4
---

# 1) Prompt (para entregar a un LLM) {#sec-prompt}

> Copia y pega TODO este bloque en el modelo.  
> Requisito: el modelo debe respetar el glosario y las referencias cruzadas incluidas.

```text
Eres un arquitecto senior de frontend. Diseña y genera una solución 100% frontend con React + TypeScript. No hay backend. La app es offline-first y debe aplicar arquitectura hexagonal (Ports & Adapters).

IMPORTANTE: 
- Debes basarte en el Glosario (ver #glosario) y usar esos términos como contrato.
- Debes respetar el flujo de UI y maquetas ASCII descritas (ver #ui-ascii).
- Los puertos (interfaces) deben vivir en los paquetes/módulos “puros” (ver #arquitectura-hexagonal).
- Mantén el esquema SQL y migraciones en nivel básico (no complejo), pero completo para el alcance.

# (A) PRODUCTO Y CONCEPTO

## (A1) Entidad principal de usuario: Cuaderno (ver #def-cuaderno)
El sistema organiza el trabajo en “Cuadernos” (ver #def-cuaderno). 
Un Cuaderno se compone de:
- un Texto original (ver #def-texto-original): texto insertado por el usuario y conservado tal cual (inmutable).
- uno o más Textos de lectura (ver #def-texto-de-lectura): derivados del Texto original mediante segmentación.

## (A2) Fragmentos y lectura (ver #fragmento-de-lectura, #modo-de-lectura)
Un Texto de lectura se subdivide en Fragmentos de lectura (ver #fragmento-de-lectura), que pueden ser:
- Oraciones (default)
- Párrafos (opcional)

El Modo de lectura (ver #modo-de-lectura) ocupa la pantalla completa y muestra SOLO un Fragmento de lectura a la vez.

## (A3) Navegación y controles (ver #def-controles-lectura)
Los controles de navegación del Modo de lectura son obligatorios (teclado + UI clicable):
- Siguiente: Enter, Espacio, Flecha hacia adelante (→), botón en pantalla.
- Anterior: Flecha hacia atrás (←), botón en pantalla.
Debe existir indicador de progreso mostrando en qué Fragmento de lectura va (ej. “12/240”) (ver #fragmento-de-lectura).

## (A4) Edición y comentarios (ver #fragmento-de-lectura)
En Modo de lectura:
- El Fragmento de lectura puede editarse o eliminarse.
- Los comentarios son tipo “hilo” (múltiples comentarios por Fragmento), persistidos en la base de datos.
- No se requiere autor, fecha, edición o borrado de comentarios.

# (B) UI / EXPERIENCIA DE USUARIO

## (B1) Layout principal con sidebar (biblioteca)
La app tiene un layout con sidebar (izquierda) que muestra:
- “Crear nuevo cuaderno”
- lista de cuadernos
- por cada cuaderno, botón “Crear texto de lectura”
- y debajo, lista de “Textos de lectura” con botón “Leer” para abrir el Modo de lectura.

El layout esperado (referencial) es:

|nombre_app (sidebar)                             | (detalle)       |
|[Crear nuevo cuaderno]                           |                 |
|-------------------------------------------------|                 |
|Primer cuaderno  [Crear texto de lectura]        |                 |
|--Texto de lectura 1                      [Leer] |                 |
|--Texto de lectura 2                      [Leer] |                 |
|Segundo cuaderno  [Crear texto de lectura]       |                 |
|--Texto de lectura 1                      [Leer] |                 |
|--Texto de lectura 2                      [Leer] |                 |

## (B2) Pantallas obligatorias
Debes implementar y describir estas pantallas/estados:
1) Biblioteca / Cuadernos (sidebar + detalle)
2) Detalle de Cuaderno:
   - crear/editar Texto original (inmutable una vez creado; ver #def-texto-original)
   - crear Texto(s) de lectura desde ese Texto original (ver #def-texto-de-lectura)
3) Modo de lectura (pantalla completa) mostrando un Fragmento de lectura (ver #modo-de-lectura)
4) Modales: edición de fragmento, confirmación de eliminación, import/export

## (B3) “Enfoque”
El Modo de lectura ya es el “fondo de enfoque”: muestra SOLO el Fragmento de lectura (ver #modo-de-lectura), pero los controles (ver #def-controles-lectura) siempre deben estar “a la mano” (visibles o accesibles sin fricción). No ocultarlos por completo.

## (B4) Accesibilidad
Accesibilidad obligatoria:
- navegación 100% por teclado
- gestión de foco en modales
- ARIA donde corresponda (diálogos, botones, regiones)

# (C) SEGMENTACIÓN (SIMPLIFICADA)

Requisitos:
- Reglas básicas: separar por saltos de línea (para párrafos) y puntos/fin de oración (para oraciones).
- No importa si rompe mal por abreviaturas “Dr.” “etc.”, decimales, comillas, paréntesis o signos “¿¡”.
- No se recalcula la segmentación cuando se edita un fragmento.
- No se permite fusionar o dividir manualmente una unidad.

# (D) PERSISTENCIA LOCAL (OBLIGATORIA Y BÁSICA)

Tecnologías:
- SQLite en navegador usando sql.js
- Persistir archivo SQLite en IndexedDB

Requisitos:
- Bootstrap DB: crear DB si no existe, cargar si existe.
- Migraciones/versionado: básico (ej. tabla schema_version y scripts incrementales simples).
- Import/Export:
  - Exportar DB (.sqlite)
  - Importar DB (.sqlite)
  - (Opcional recomendado) Exportar/Importar un Cuaderno o Texto de lectura como JSON
- Tamaño: mantén el enfoque “lo más sencillo”; no prometas soporte para textos masivos. 
- UI debe evitar renderizar miles de fragmentos a la vez: mostrar uno, consultar por posición.

# (E) ARQUITECTURA HEXAGONAL Y MODULARIDAD

## (E1) Regla de “paquetes/módulos”
Los puertos van dentro de los paquetes/módulos “puros”.
En los paquetes/módulos están los hexágonos puros: lógica agnóstica de librerías e implementaciones externas.

## (E2) Capas y dependencias permitidas
- Dominio: entidades, value objects, invariantes. No depende de React, sql.js, IndexedDB.
- Aplicación: casos de uso + puertos (interfaces). Depende de dominio.
- Infraestructura: adaptadores concretos (sql.js/IndexedDB), bootstrap/DI, router wiring si aplica.
- UI: React pages/components/hooks. Consume casos de uso o una fachada de aplicación; no toca DB directo.

## (E3) Modularidad: varios hexágonos posibles
No uses “segundo paquete” ambiguo. 
En su lugar:
- Crea una estructura modular que permita añadir nuevos módulos/hexágonos en el futuro.
- En esta entrega implementa el módulo principal (p.ej. “reader”), pero deja clara la ruta para añadir otros módulos luego.

# (F) ENTREGABLES (OBLIGATORIOS)

Tu respuesta debe incluir:

1) Diagrama textual de capas y dependencias.
2) Árbol de carpetas propuesto, modular, incluyendo:
   - módulos con domain/application (puros)
   - infrastructure/ui (impuro)
   - bootstrap/DI
3) Modelo de datos (SQL) básico:
   - cuadernos
   - textos originales
   - textos de lectura
   - fragmentos (por texto de lectura)
   - comentarios (por fragmento)
   - estado de lectura/progreso (por texto de lectura)
   - schema_version para migraciones
4) Lista de casos de uso (Application) cubriendo:
   - CRUD mínimo de Cuaderno
   - Crear Texto original
   - Crear Texto de lectura (segmentación)
   - Abrir lectura
   - Siguiente/Anterior fragmento
   - Editar/Eliminar fragmento
   - Agregar/Listar comentarios
   - Guardar/restaurar progreso
   - Import/Export DB (y JSON si decides implementarlo)
5) Contratos (interfaces TS) de puertos dentro del módulo application.
6) Adaptadores concretos en infraestructura (sql.js + IndexedDB).
7) Bootstrap: inicialización DB + migraciones + composición de dependencias.
8) UI scaffolding:
   - Sidebar/Biblioteca
   - Detalle de cuaderno
   - Modo de lectura
   - Modales requeridos
   - manejo de teclado/foco

Además:
- Si asumes algo, decláralo explícitamente como “Suposición”.

# (G) UI ASCII (DEBES INCLUIR Y SEGUIR ESTO)

## (G1) Estado global: bootstrap DB
[ARRANQUE]
+--------------------------------------------------------------+
| App Reader                                                   |
+--------------------------------------------------------------+
| Inicializando base de datos local...                          |
| - Abriendo IndexedDB                                          |
| - Cargando sql.js                                             |
| - Aplicando migraciones (básicas)                             |
|                                                              |
| [##########...............]                                   |
+--------------------------------------------------------------+

## (G2) Layout con sidebar (biblioteca)
[LAYOUT BASE]
+------------------------------+--------------------------------+
| nombre_app                   | Detalle                        |
| [Crear nuevo cuaderno]       |                                |
|------------------------------|                                |
| Primer cuaderno [Crear texto |                                |
| de lectura]                  |                                |
|   - Texto lectura 1 [Leer]   |                                |
|   - Texto lectura 2 [Leer]   |                                |
| Segundo cuaderno [Crear texto|                                |
| de lectura]                  |                                |
|   - Texto lectura 1 [Leer]   |                                |
+------------------------------+--------------------------------+

## (G3) Modo de lectura (pantalla completa + controles siempre a la mano)
[MODO LECTURA]
+--------------------------------------------------------------+
| Lectura: (Cuaderno / Texto de lectura)          12 / 240      |
| [Salir]                                                      |
+--------------------------------------------------------------+
|                                                              |
|          "Aquí va el Fragmento de lectura actual"            |
|                                                              |
+--------------------------------------------------------------+
| [<< Anterior]                 [Siguiente >>]                 |
| Atajos: Enter/Espacio/→=Siguiente | ←=Anterior               |
+--------------------------------------------------------------+
| Acciones: [Editar] [Eliminar]                                |
| Comentarios (hilo):                                          |
| - "comentario 1"                                             |
| - "comentario 2"                                             |
| Añadir: [______________________________] [Añadir]            |
+--------------------------------------------------------------+

## (G4) Editar fragmento (modal)
[MODAL EDITAR]
+--------------------------- MODAL ----------------------------+
| Editar fragmento                                         X  |
+--------------------------------------------------------------+
| Texto actual:                                                |
| +----------------------------------------------------------+ |
| | (texto del fragmento)                                     | |
| +----------------------------------------------------------+ |
| [Cancelar]                                  [Guardar cambios] |
+--------------------------------------------------------------+

## (G5) Eliminar fragmento (modal confirmación)
[MODAL ELIMINAR]
+--------------------------- MODAL ----------------------------+
| Eliminar fragmento                                        X  |
+--------------------------------------------------------------+
| ¿Seguro que desea eliminar este fragmento?                   |
| [Cancelar]                                       [Eliminar]  |
+--------------------------------------------------------------+

## (G6) Import/Export (modal)
[MODAL IMPORT/EXPORT]
+--------------------------- MODAL ----------------------------+
| Importar / Exportar                                         X|
+--------------------------------------------------------------+
| ( ) Importar DB (.sqlite)                                    |
| ( ) Exportar DB (.sqlite)                                    |
| ( ) Importar JSON (cuaderno o texto de lectura)  (opcional)  |
| ( ) Exportar JSON (cuaderno o texto de lectura)  (opcional)  |
| Archivo: [________________________] [Seleccionar...]         |
| [Cancelar]                                      [Continuar]  |
+--------------------------------------------------------------+

FIN DEL PROMPT
````

---

# 2) Glosario (incluido en el prompt) {#glosario}

> Este glosario es parte del contrato. Los IDs se usan como referencias cruzadas en el prompt.

## Un cuaderno {#def-cuaderno}

Se compone de:

* [Texto original](#def-texto-original)
* [Texto de lectura](#def-texto-de-lectura)

## Texto original {#def-texto-original}

Es el texto insertado y se mantiene tal cual (inmutable).

## Texto de lectura {#def-texto-de-lectura}

Es un derivado generado desde el Texto original mediante segmentación. Contiene fragmentos navegables (ver [Fragmentos de lectura](#fragmento-de-lectura)) y progreso de lectura.

## Fragmentos de lectura {#fragmento-de-lectura}

Son las oraciones o párrafos en las cuales se subdivide el texto dependiendo de lo elegido.

## Modo de lectura {#modo-de-lectura}

Pantalla que ocupa toda la pantalla en la cual solo va apareciendo uno a uno los [Fragmentos de lectura](#fragmento-de-lectura).

## Controles de navegación del modo lectura {#def-controles-lectura}

* Flechas (← / →)
* Para siguiente: Enter, Espacio, flecha hacia adelante (→), botón clicable en pantalla.
* Para anterior: flecha de atrás (←), botón clicable en pantalla.

---

# 3) Explicación de lo que se va a crear (lectura del prompt) {#sec-explicacion}

Esta sección explica el sistema descrito en #sec-prompt usando el glosario (#glosario) y apuntando a los elementos de UI (#ui-ascii) y reglas.

## 3.1 Estructura funcional {#sec-exp-funcional}

* El usuario crea un [Cuaderno](#def-cuaderno) desde el sidebar (ver #ui-ascii, “LAYOUT BASE”).
* Dentro del cuaderno, ingresa el [Texto original](#def-texto-original). Este texto se conserva inmutable.
* Luego genera uno o más [Textos de lectura](#def-texto-de-lectura) (botón “Crear texto de lectura” en el sidebar/árbol).
* Cada texto de lectura produce [Fragmentos de lectura](#fragmento-de-lectura) por segmentación básica.
* Al presionar “Leer”, se abre el [Modo de lectura](#modo-de-lectura), mostrando solo un fragmento por vez (ver “MODO LECTURA”).

## 3.2 Experiencia de lectura y progreso {#sec-exp-progreso}

* El indicador “12/240” del Modo lectura es el progreso dentro de los [Fragmentos de lectura](#fragmento-de-lectura).
* La navegación se controla con los [Controles de navegación](#def-controles-lectura).
* Los controles siempre están a la mano (en pantalla y con teclado), alineado con el requisito de enfoque.

## 3.3 Edición, eliminación y comentarios {#sec-exp-edicion}

* El fragmento actual puede editarse desde el modal “EDITAR” (ver #ui-ascii, “MODAL EDITAR”).
* Puede eliminarse con confirmación (ver “MODAL ELIMINAR”).
* Los comentarios son hilo: múltiples entradas asociadas al fragmento, persistidas en DB. No requieren autor/fecha/edición/borrado.

## 3.4 Persistencia offline-first {#sec-exp-persistencia}

* Toda la información vive en SQLite (sql.js) y se persiste en IndexedDB.
* El arranque ejecuta bootstrap DB (ver “ARRANQUE”):

  * cargar DB existente o crear una nueva
  * aplicar migraciones básicas
* Import/Export:

  * DB .sqlite (obligatorio)
  * JSON por cuaderno o texto de lectura (opcional recomendado)

## 3.5 Arquitectura y modularidad {#sec-exp-arq}

* El núcleo puro (dominio + aplicación) vive en módulos/paquetes (hexágonos puros).
* La aplicación define puertos (interfaces) y casos de uso.
* Infraestructura implementa adaptadores (sql.js/IndexedDB) y hace el bootstrap.
* UI en React consume casos de uso/fachada.
* La estructura modular evita el “segundo paquete ambiguo” y deja preparado el sistema para múltiples módulos futuros.

---

# 4) UI ASCII (sección de referencia) {#ui-ascii}

> Esta sección existe para referencias cruzadas; el prompt ya incluye estas maquetas en el bloque (ver #sec-prompt).

* Bootstrap DB: ver “ARRANQUE” en el prompt.
* Layout con sidebar: ver “LAYOUT BASE” en el prompt.
* Modo lectura: ver “MODO LECTURA” en el prompt.
* Modales: ver “MODAL EDITAR”, “MODAL ELIMINAR”, “MODAL IMPORT/EXPORT”.

```
